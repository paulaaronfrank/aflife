{% extends "base.html" %}

{% block title %}Traveling - Aaron Frank{% endblock %}

{% block content %}
<!-- Gradient Background -->
<div class="gradient-background">
    <div class="gradient-sphere sphere-1"></div>
    <div class="gradient-sphere sphere-2"></div>
    <div class="gradient-sphere sphere-3"></div>
    <div class="grid-overlay"></div>
    <div class="noise-overlay"></div>
    <div class="particles-container" id="particles-container"></div>
</div>

<!-- Mouse Follower -->
<div class="mouse-follower"></div>

<!-- Back Arrow -->
<div class="back-arrow-container">
    <a href="/" class="back-arrow" title="Back to Home">
        <i class="fas fa-arrow-left"></i>
    </a>
</div>

<!-- Travel Hero Section -->
<section class="travel-hero">
    <div class="container-fluid">
        <div class="row align-items-center" style="min-height: 100vh;">
            <!-- Left Side - Country Counter -->
            <div class="col-lg-6">
                <div class="hero-content px-4 px-lg-5">
                    <!-- Main Title -->
                    <div class="mb-4">
                        <h1 class="display-1 fw-bold mb-3 hero-title">Countries Visited</h1>
                    </div>

                    <!-- Country Counter -->
                    <div class="mb-4">
                        <div class="country-counter">
                            <span id="country-number" class="display-1 fw-bold text-primary">{{ visited_count }}</span>
                        </div>
                        <p class="h4 text-muted">and counting...</p>
                    </div>
                </div>
            </div>

            <!-- Right Side - Interactive World Map -->
            <div class="col-lg-6">
                <div class="map-container position-relative">
                    <div class="world-map-wrapper">
                        <img src="{{ url_for('static', filename='images/page/world-map.jpg') }}" 
                             alt="World Map" 
                             class="world-map-image">
                        <div class="map-overlay">
                            <button class="btn btn-primary btn-lg explore-map-btn" id="explore-map-btn" data-bs-toggle="modal" data-bs-target="#worldMapModal">
                                <i class="fas fa-globe me-2"></i>Explore Interactive Map
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scroll Down Indicator -->
    <div class="scroll-indicator">
        <div class="scroll-arrow">
            <i class="fas fa-chevron-down"></i>
        </div>
        <span class="scroll-text">Scroll to explore</span>
    </div>
</section>

<!-- Travel Sections -->
<section class="travel-sections py-5" style="position: relative; z-index: 10;">
    <div class="container">
        <!-- Round The World 2026 -->
        <div class="travel-section mb-5">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="section-content">
                        <h2 class="display-4 fw-bold mb-4">Round The World 2026</h2>
                        <p class="lead mb-4">
                            An epic journey planned to visit every continent in a single year. 
                            From the bustling streets of Tokyo to the serene landscapes of New Zealand, 
                            this adventure will be the culmination of years of travel dreams.
                        </p>
                        <div class="section-stats">
                            <div class="stat-item">
                                <span class="stat-number">12</span>
                                <span class="stat-label">Months</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">50+</span>
                                <span class="stat-label">Countries</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">7</span>
                                <span class="stat-label">Continents</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="section-image">
                        <img src="https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=600&h=400&fit=crop" 
                             alt="Round The World Journey" class="img-fluid rounded-3 shadow-lg">
                    </div>
                </div>
            </div>
        </div>

        <!-- My Life in Canada -->
        <div class="travel-section mb-5">
            <div class="row align-items-center">
                <div class="col-lg-6 order-lg-2">
                    <div class="section-content">
                        <h2 class="display-4 fw-bold mb-4">My Life in Canada</h2>
                        <p class="lead mb-4">
                            From the Rocky Mountains to the Atlantic coast, Canada has been my home 
                            and playground for adventure. Exploring the vast wilderness, experiencing 
                            diverse cultures, and embracing the Canadian way of life.
                        </p>
                        <div class="section-stats">
                            <div class="stat-item">
                                <span class="stat-number">8</span>
                                <span class="stat-label">Years</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">10</span>
                                <span class="stat-label">Provinces</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">3</span>
                                <span class="stat-label">Territories</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 order-lg-1">
                    <div class="section-image">
                        <img src="https://images.unsplash.com/photo-1506905925346-14b1e611dbb8?w=600&h=400&fit=crop" 
                             alt="Canadian Adventure" class="img-fluid rounded-3 shadow-lg">
                    </div>
                </div>
            </div>
        </div>

        <!-- Gap Year 2015 -->
        <div class="travel-section mb-5">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="section-content">
                        <h2 class="display-4 fw-bold mb-4">Gap Year 2015</h2>
                        <p class="lead mb-4">
                            The journey that started it all. A transformative year backpacking through 
                            Southeast Asia, discovering new cultures, and finding my passion for travel. 
                            From the temples of Angkor Wat to the beaches of Thailand.
                        </p>
                        <div class="section-stats">
                            <div class="stat-item">
                                <span class="stat-number">12</span>
                                <span class="stat-label">Months</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">15</span>
                                <span class="stat-label">Countries</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">1</span>
                                <span class="stat-label">Life Changed</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="section-image">
                        <img src="https://images.unsplash.com/photo-1506905925346-14b1e611dbb8?w=600&h=400&fit=crop" 
                             alt="Gap Year Adventure" class="img-fluid rounded-3 shadow-lg">
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
// World map interaction
const worldMapImage = document.querySelector('.world-map-image');
const mapOverlay = document.querySelector('.map-overlay');
const exploreBtn = document.getElementById('explore-map-btn');

// Map container hover effects
const mapContainer = document.querySelector('.map-container');
mapContainer.addEventListener('mouseenter', function() {
    worldMapImage.style.filter = 'blur(2px)';
    mapOverlay.style.opacity = '1';
    mapOverlay.style.visibility = 'visible';
});

mapContainer.addEventListener('mouseleave', function() {
    worldMapImage.style.filter = 'blur(0)';
    mapOverlay.style.opacity = '0';
    mapOverlay.style.visibility = 'hidden';
});

// World Map Modal Functionality
let worldMapModal;
let worldMapIframe;

// Function to generate Fla-shop.com embed URL
function generateEmbedUrl(isoCodes) {
    console.log('=== URL Generation Debug ===');
    console.log('Input ISO codes:', isoCodes);
    
    if (!isoCodes || isoCodes.length === 0) {
        console.log('No ISO codes provided, using empty map');
        return 'https://www.fla-shop.com/visited-countries/embed/?st=&vc=1ca032&uc=b3c3ca&hc=40bfa6&bc=ffffff';
    }
    
    // Join ISO codes with %2C (URL encoded comma)
    const isoCodesString = isoCodes.join('%2C');
    console.log('ISO codes string (URL encoded):', isoCodesString);
    
    // Construct the complete embed URL
    const baseUrl = 'https://www.fla-shop.com/visited-countries/embed/';
    const params = `?st=${isoCodesString}&vc=1ca032&uc=b3c3ca&hc=40bfa6&bc=ffffff`;
    const fullUrl = baseUrl + params;
    
    console.log('Base URL:', baseUrl);
    console.log('Parameters:', params);
    console.log('Full URL:', fullUrl);
    console.log('=== End URL Generation Debug ===');
    
    return fullUrl;
}

// Function to fetch visited countries and update map
async function loadWorldMap() {
    console.log('🌍 Starting world map load process...');
    
    try {
        console.log('📡 Fetching visited countries from API...');
        const response = await fetch('/api/countries/visited/iso-codes');
        
        console.log('📡 API Response status:', response.status);
        console.log('📡 API Response headers:', response.headers);
        
        if (!response.ok) {
            throw new Error(`API request failed with status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('📡 API Response data:', data);
        
        // Generate the embed URL
        const embedUrl = generateEmbedUrl(data.iso_codes);
        
        console.log('🔗 Setting iframe source to:', embedUrl);
        
        // Update the iframe source
        worldMapIframe.src = embedUrl;
        
        // Add load event listener to iframe
        worldMapIframe.onload = function() {
            console.log('✅ Iframe loaded successfully');
        };
        
    } catch (error) {
        console.error('❌ Error loading world map:', error);
    }
}

// Function to show fallback content
function showFallbackContent(isoCodes) {
    console.log('🔄 Showing fallback content for ISO codes:', isoCodes);
    
    worldMapIframe.style.display = 'none';
    const container = document.getElementById('world-map-container');
    
    const fallbackHtml = `
        <div class="text-center p-5">
            <h4><i class="fas fa-globe me-2"></i>Interactive World Map</h4>
            <p class="lead">Visited Countries: ${isoCodes.length > 0 ? isoCodes.join(', ') : 'None'}</p>
            <p class="text-muted">Map visualization temporarily unavailable</p>
            <a href="https://www.fla-shop.com/visited-countries/" target="_blank" class="btn btn-primary">
                <i class="fas fa-external-link-alt me-2"></i>View on Fla-shop.com
            </a>
        </div>
    `;
    
    container.innerHTML = fallbackHtml;
}

// Initialize modal functionality when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    console.log('🔧 Initializing world map modal...');
    
    // Get modal elements
    worldMapModal = document.getElementById('worldMapModal');
    worldMapIframe = document.getElementById('world-map-iframe');
    
    console.log('🔧 Modal element:', worldMapModal);
    console.log('🔧 Iframe element:', worldMapIframe);
    
    if (worldMapModal && worldMapIframe) {
        console.log('✅ Modal and iframe elements found, setting up event listeners...');
        
        // Load map when modal is shown
        worldMapModal.addEventListener('show.bs.modal', function() {
            console.log('🚀 Modal opening, loading world map...');
            loadWorldMap();
        });
        
        // Clear iframe when modal is hidden to save resources
        worldMapModal.addEventListener('hidden.bs.modal', function() {
            console.log('🔄 Modal closing, clearing iframe...');
            worldMapIframe.src = '';
            worldMapIframe.style.display = 'block';
            
            // Reset container content
            const container = document.getElementById('world-map-container');
            container.innerHTML = `
                <div style="position:relative;padding: 0 0 67% 0;height:0;overflow:hidden;">
                    <iframe id="world-map-iframe" 
                            style="position:absolute;top:0;left:0;width:100%;height:100%;" 
                            src="" 
                            frameborder="0" 
                            scrolling="no">
                    </iframe>
                </div>
            `;
        });
        
        console.log('✅ Modal event listeners set up successfully!');
    } else {
        console.error('❌ World map modal or iframe not found!');
        console.error('Modal:', worldMapModal);
        console.error('Iframe:', worldMapIframe);
    }
});

// Scroll indicator functionality
const scrollIndicator = document.querySelector('.scroll-indicator');

window.addEventListener('scroll', function() {
    if (window.scrollY > 100) {
        scrollIndicator.style.opacity = '0';
        scrollIndicator.style.transform = 'translateX(-50%) translateY(20px)';
    } else {
        scrollIndicator.style.opacity = '1';
        scrollIndicator.style.transform = 'translateX(-50%) translateY(0)';
    }
});

// Smooth scroll when clicking the scroll indicator
scrollIndicator.addEventListener('click', function() {
    const travelSections = document.querySelector('.travel-sections');
    travelSections.scrollIntoView({ 
        behavior: 'smooth',
        block: 'start'
    });
});
</script>

<style>
/* Ensure scrolling works */
html, body {
    overflow-x: hidden;
    overflow-y: auto;
    height: auto;
}

/* Back Arrow */
.back-arrow-container {
    position: fixed;
    top: 30px;
    left: 30px;
    z-index: 1000;
}

.back-arrow {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    color: white;
    text-decoration: none;
    font-size: 1.2rem;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.back-arrow:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.5);
    color: white;
    transform: translateX(-5px);
    text-decoration: none;
    will-change: transform;
}

.travel-hero {
    min-height: 100vh;
    position: relative;
    z-index: 5;
    display: flex;
    align-items: center;
    overflow: visible;
}

/* Scroll Down Indicator */
.scroll-indicator {
    position: absolute;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    color: rgba(255, 255, 255, 0.8);
    z-index: 1000;
    animation: bounce 2s infinite;
    transition: all 0.3s ease;
    cursor: pointer;
}

.scroll-indicator:hover {
    color: rgba(255, 255, 255, 1);
    transform: translateX(-50%) scale(1.1);
}

.scroll-arrow {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    display: block;
}

.scroll-text {
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 300;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateX(-50%) translateY(0);
    }
    40% {
        transform: translateX(-50%) translateY(-10px);
    }
    60% {
        transform: translateX(-50%) translateY(-5px);
    }
}

.country-counter {
    text-align: center;
    margin: 2rem 0;
}

.country-counter #country-number {
    font-size: 8rem;
    font-weight: 900;
    background: linear-gradient(45deg, #3498db, #9b59b6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 30px rgba(52, 152, 219, 0.3);
}

.map-container {
    height: 500px;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.world-map-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    border-radius: 15px;
}

.world-map-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: filter 0.3s ease;
    border-radius: 15px;
}

.map-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    border-radius: 15px;
}

.explore-map-btn {
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.3) !important;
    border-radius: 50px !important;
    color: white !important;
    font-weight: 600;
    padding: 1rem 2rem;
    font-size: 1.1rem;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transform: translateY(20px);
    transition: all 0.3s ease;
    position: relative;
    will-change: transform;
}

.explore-map-btn:hover {
    background: rgba(255, 255, 255, 0.2) !important;
    border-color: rgba(255, 255, 255, 0.5) !important;
    color: white !important;
    transform: translateY(0) scale(1.05);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    text-decoration: none;
}

.explore-map-btn:focus {
    background: rgba(255, 255, 255, 0.2) !important;
    border-color: rgba(255, 255, 255, 0.5) !important;
    color: white !important;
    box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.25);
}

.map-overlay:hover .explore-map-btn {
    transform: translateY(0);
}

.country {
    cursor: pointer;
    transition: all 0.3s ease;
}

.country:hover {
    filter: drop-shadow(0 0 10px rgba(52, 152, 219, 0.8));
}

/* Travel Sections */
.travel-sections {
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    position: relative;
    z-index: 10;
    overflow: visible;
}

.travel-section {
    padding: 4rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.travel-section:last-child {
    border-bottom: none;
}

.section-content h2 {
    background: linear-gradient(45deg, #3498db, #9b59b6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1.5rem;
}

.section-content p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
    line-height: 1.6;
}

.section-stats {
    display: flex;
    gap: 2rem;
    margin-top: 2rem;
}

.stat-item {
    text-align: center;
}

.stat-number {
    display: block;
    font-size: 2.5rem;
    font-weight: 900;
    color: #3498db;
    line-height: 1;
}

.stat-label {
    display: block;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.6);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 0.5rem;
}

.section-image img {
    transition: transform 0.3s ease;
}

.section-image:hover img {
    transform: scale(1.05);
}

@media (max-width: 768px) {
    .back-arrow-container {
        top: 20px;
        left: 20px;
    }
    
    .back-arrow {
        width: 45px;
        height: 45px;
        font-size: 1rem;
    }
    
    .country-counter #country-number {
        font-size: 5rem;
    }
    
    .map-container {
        height: 300px;
        margin-top: 0.5rem;
    }
    
    .travel-hero {
        min-height: auto !important;
        padding: 2rem 0;
    }
    
    .travel-hero .row {
        min-height: auto !important;
        justify-content: flex-start !important;
        align-items: flex-start !important;
    }
    
    .travel-hero .col-lg-6:first-child {
        margin-bottom: 0;
        padding-bottom: 0;
    }
    
    .travel-hero .col-lg-6:last-child {
        margin-top: 0;
        padding-top: 0;
    }
    
    .hero-content {
        margin-bottom: 0;
        padding-bottom: 0;
    }
    
    .map-container {
        margin-top: 0 !important;
        margin-bottom: 10rem !important;
    }
    
    .scroll-indicator {
        bottom: 60px;
        z-index: 1000;
    }
    
    .scroll-arrow {
        font-size: 1.2rem;
    }
    
    .scroll-text {
        font-size: 0.8rem;
    }
    
    .section-stats {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .travel-section {
        padding: 2rem 0;
    }
    
    .section-content h2 {
        font-size: 2.5rem;
    }
    
    .explore-map-btn {
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
    }
}
</style>

<!-- World Map Modal -->
<div class="modal fade" id="worldMapModal" tabindex="-1" aria-labelledby="worldMapModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="worldMapModalLabel">
                    <i class="fas fa-globe me-2"></i>Interactive World Map
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <div id="world-map-container" style="max-width:980px;margin:5px auto 10px auto;font-size:14px;">
                    <div style="position:relative;padding: 0 0 67% 0;height:0;overflow:hidden;">
                        <iframe id="world-map-iframe" 
                                style="position:absolute;top:0;left:0;width:100%;height:100%;" 
                                src="" 
                                frameborder="0" 
                                scrolling="no">
                        </iframe>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
